const CACHE_VERSION="1.6.0",CACHE_NAME="renov-cache-v1.6.0",isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),MOBILE_CONFIG={maxCacheSize:15728640,cacheStrategy:"cache-first",criticalResources:["/","/index.html","/styles.css","/script.js","/assets/images/Renov-Logo.webp"],lcpOptimization:{criticalElements:[".hero-text h1",".logo img"],deferNonCritical:!0,fontDisplay:"swap",reduceAnimations:!0,optimizeImages:!0,minimizeRequests:!0}},CACHE_STRATEGIES={CRITICAL:{name:"critical",urls:["/","/index.html","/styles.css","/script.js","/assets/images/Renov-Logo.webp"],strategy:"cache-first",maxAge:31536e3},STATIC:{name:"static",urls:["/bg-video-compressed.webm","/bg-IA-compressed.webm","/assets/images/missao.webp","/assets/images/visao.webp","/assets/images/valores.webp","/assets/images/ismael-kolling.webp","/assets/images/matheus-mundstock.webp","/assets/icons/ia-icon.webp","/assets/icons/app-icon.webp","/assets/icons/api-icon.webp","/assets/icons/logistics-icon.webp","/assets/icons/results-icon.webp","/assets/icons/esg-icon.webp"],strategy:"cache-first",maxAge:isMobile?302400:2592e3},EXTERNAL:{name:"external",urls:["https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"],strategy:"stale-while-revalidate",maxAge:isMobile?21600:86400},DYNAMIC:{name:"dynamic",urls:[],strategy:"network-first",maxAge:isMobile?900:3600}},CACHE_METADATA={version:"1.6.0",timestamp:Date.now(),strategies:CACHE_STRATEGIES};function getCacheStrategy(e){const t=new URL(e.url);return CACHE_STRATEGIES.CRITICAL.urls.includes(t.pathname)||"/"===t.pathname||"/index.html"===t.pathname?CACHE_STRATEGIES.CRITICAL:CACHE_STRATEGIES.STATIC.urls.includes(t.pathname)||isStaticResource(e)?CACHE_STRATEGIES.STATIC:"cdnjs.cloudflare.com"===t.hostname||"fonts.googleapis.com"===t.hostname||"fonts.gstatic.com"===t.hostname?CACHE_STRATEGIES.EXTERNAL:("document"===e.destination||"script"===e.destination||t.pathname.endsWith(".html"),CACHE_STRATEGIES.DYNAMIC)}function isStaticResource(e){const t=new URL(e.url);return[".css",".js",".png",".jpg",".jpeg",".gif",".ico",".svg",".webp",".woff",".woff2",".ttf",".otf",".mp4",".webm",".ogg"].some(e=>t.pathname.includes(e))||"image"===e.destination||"video"===e.destination||"font"===e.destination}async function handleRequest(e,t,a){const s=`${CACHE_NAME}-${a.name}`;try{switch(a.strategy){case"cache-first":return await cacheFirstStrategy(e,t,s,a.maxAge);case"network-first":default:return await networkFirstStrategy(e,t,s,a.maxAge);case"stale-while-revalidate":return await staleWhileRevalidateStrategy(e,t,s,a.maxAge)}}catch(e){console.error("Erro no handleRequest:",e);const a=await caches.match(t);return a||new Response("Erro de rede",{status:503})}}async function cacheFirstStrategy(e,t,a,s){const n=await caches.open(a),c=await n.match(t);if(c&&!isExpired(c,s))return console.log("Serving from cache (cache-first):",t),c;try{const a=await fetch(e);if(a&&200===a.status){const e=a.clone();await n.put(t,addCacheHeaders(e,s)),console.log("Updated cache (cache-first):",t)}return a}catch(e){return console.log("Network failed, using cached response:",t),c||new Response("Erro de rede",{status:503})}}async function networkFirstStrategy(e,t,a,s){try{const n=await fetch(e);if(n&&200===n.status){const e=await caches.open(a),c=n.clone();await e.put(t,addCacheHeaders(c,s)),console.log("Updated cache (network-first):",t)}return n}catch(e){console.log("Network failed, trying cache:",t);const s=await caches.open(a);return await s.match(t)||new Response("Erro de rede",{status:503})}}async function staleWhileRevalidateStrategy(e,t,a,s){const n=await caches.open(a),c=await n.match(t);if(c&&!isExpired(c,s))return console.log("Serving from cache (stale-while-revalidate):",t),fetch(e).then(async e=>{if(e&&200===e.status){const a=e.clone();await n.put(t,addCacheHeaders(a,s)),console.log("Background cache update:",t)}}).catch(e=>{console.log("Background update failed:",t,e)}),c;try{const a=await fetch(e);if(a&&200===a.status){const e=a.clone();await n.put(t,addCacheHeaders(e,s)),console.log("Updated cache (stale-while-revalidate):",t)}return a}catch(e){return console.log("Network failed, using expired cache:",t),c||new Response("Erro de rede",{status:503})}}function isExpired(e,t){const a=e.headers.get("x-cache-time");if(!a)return!1;return Date.now()-parseInt(a)>1e3*t}function addCacheHeaders(e,t){const a=new Headers(e.headers);return a.set("x-cache-time",Date.now().toString()),a.set("x-cache-max-age",t.toString()),new Response(e.body,{status:e.status,statusText:e.statusText,headers:a})}self.addEventListener("install",e=>{e.waitUntil(caches.open(`${CACHE_NAME}-critical`).then(e=>(console.log("Instalando cache crítico..."),e.addAll(CACHE_STRATEGIES.CRITICAL.urls))).then(()=>self.skipWaiting()).then(()=>Promise.allSettled([caches.open(`${CACHE_NAME}-static`).then(e=>e.addAll(CACHE_STRATEGIES.STATIC.urls)),caches.open(`${CACHE_NAME}-external`).then(e=>e.addAll(CACHE_STRATEGIES.EXTERNAL.urls))])).then(()=>{console.log("Service Worker v1.6.0 instalado com sucesso")}).catch(e=>{console.error("Erro na instalação do cache:",e)}))}),self.addEventListener("fetch",e=>{const t=e.request,a=new URL(t.url),s=a.origin+a.pathname,n=getCacheStrategy(t);e.respondWith(handleRequest(t,s,n))}),self.addEventListener("activate",e=>{e.waitUntil(Promise.all([caches.keys().then(e=>Promise.all(e.map(e=>{if(!e.startsWith(CACHE_NAME))return console.log("Removendo cache antigo:",e),caches.delete(e)}))),self.clients.claim()]).then(()=>{console.log("Service Worker v1.6.0 ativado")}))}),self.addEventListener("message",e=>{e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting(),e.data&&"CLEAR_CACHE"===e.data.type&&caches.keys().then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>{e.ports[0].postMessage({type:"CACHE_CLEARED"})}),e.data&&"GET_CACHE_INFO"===e.data.type&&caches.keys().then(t=>{const a={version:"1.6.0",timestamp:Date.now(),caches:t};e.ports[0].postMessage({type:"CACHE_INFO",data:a})})});